// This Pine Script® code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// © TrustDec

//@version=6
indicator("BTC/ETH CME Basis Spread", overlay = false)

symbol = syminfo.tickerid

btc_cme = request.security("CME:BTC1!", timeframe.period, close)
btc_spot = request.security("BINANCE:BTCUSDT", timeframe.period, close)
eth_cme = request.security("CME:ETH1!", timeframe.period, close)
eth_spot = request.security("BINANCE:ETHUSDT", timeframe.period, close)

is_btc_chart = str.contains(symbol, "BTC")
is_eth_chart = str.contains(symbol, "ETH")

btc_spread = btc_cme - btc_spot
eth_spread = eth_cme - eth_spot

spread = is_btc_chart ? btc_spread : (is_eth_chart ? eth_spread : na)

plot(spread, title="CME Basis Spread", style=plot.style_columns, color=spread >= 0 ? color.green : color.red)
hline(0, "Zero Line", color=color.gray)

